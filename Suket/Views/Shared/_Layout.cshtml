@using Microsoft.AspNetCore.Identity
@inject SignInManager<UserAccount> SignInManager
@inject UserManager<UserAccount> UserManager

@{
    var isSignedIn = SignInManager.IsSignedIn(User);
    var user = await UserManager.GetUserAsync(User);
    var displayName = user?.NickName ?? User.Identity?.Name;
    var isAdmin = false;
    if (isSignedIn)
    {
        isAdmin = await UserManager.IsInRoleAsync(user, "Admin");
    }
}

<!DOCTYPE html>
<style>
    .footer a {
        text-decoration: none;
        color: #333; 
    }

        .footer a:hover {
            text-decoration: underline;
        }

     #header{
    /*fixedで上部固定*/
      position: fixed;
      height: 70px;
      width:100%;
      z-index: 999;/*最前面へ*/
    }

    @@media (max-width: 767px) { /* bootstrapのmdのブレークポイントは768pxなので、それより小さいデバイスでのみ適用されます */
        .footer {
            margin-bottom: 60px; /* navbarの高さに応じて調整する */
        }
        .hedp{
            margin: 0;
        }

        .nav-li-bt {
        }

        .main-top{
            padding-top:70px;
        }
    }

    @@media (min-width: 767px) {

        .hedp {
            font-size: 12px;
            margin: 0;
        }

        .nav-li-bt {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-top{
            padding-top:80px;
        }
    }


    /*　上に上がる動き　*/

    #header.UpMove{
      animation: UpAnime 0.5s forwards;
    }

    @@keyframes UpAnime{
      from {
        opacity: 1;
      transform: translateY(0);
      }
      to {
        opacity: 0;
      transform: translateY(-100px);
      }
    }

    /*　下に下がる動き　*/
    #header.DownMove {
        animation: DownAnime 0.5s forwards;
    }
    @@keyframes DownAnime{
      from {
        opacity: 0;
      transform: translateY(-100px);
      }
      to {
        opacity: 1;
      transform: translateY(0);
      }
    }

    /* アクティブなリンクのアイコンの色を変更するCSS */
    .nav-item .active .material-symbols-outlined {
        color: blue; /* または希望の色のHEXコード */
    }

    .nav-li {
        display: flex;
        align-items: center; /* 縦方向の中央揃え */
        justify-content: flex-start; /* アイテムを左側に寄せる */
    }

    .icon-right{
        margin-right: 15px;
    }

    .nav-link {
        display: flex;
        align-items:center;
        justify-content: center;
    }

    .layout-profile-icon {
        margin-right: 15px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
    }

</style>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Mint SPORTS</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Suket.styles.css" asp-append-version="true" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Akshar:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>
<body>
    <header id="header" class="DownMove">
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div class="container-fluid">
                
                <a class="navbar-brand ff-title" style="color: #5985E1;" asp-area="" asp-controller="Home" asp-action="Index">
                    <img src="~/img/logo_name.jpg" width="230" height="35">
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul class="navbar-nav flex-grow-1">
                        @if (isSignedIn)
                        {
                            <li class="nav-item nav-li d-md-none">
                                @if (!string.IsNullOrWhiteSpace(user.ProfilePictureUrl))
                                {
                                    <span><img src="@user.ProfilePictureUrl" alt="Profile Picture" class="layout-profile-icon" /></span>
                                }
                                else
                                {
                                    <span><img src="https://mintsports-profile-img.s3.ap-northeast-1.amazonaws.com/Spork_Logo.jpg" alt="Profile Picture" class="layout-profile-icon" /></span>
                                }
                                <a class="nav-link text-dark" asp-area="Identity" asp-page="/Account/Manage/Index" title="Manage">@displayName</a>
                            </li>
                        }
                        <li class="nav-item nav-li">
                            <span class="material-symbols-outlined d-md-none icon-right">
                                home
                            </span>
                            <a class="nav-link text-dark" asp-area="" asp-controller="Posts" asp-action="Index">
                                <span class="material-symbols-outlined d-none d-md-block text-center">
                                    home
                                </span>
                                <p class="hedp">Home</p>
                            </a>
                        </li>
                        @if (isSignedIn)
                        {
                            <li class="nav-item nav-li">
                                <span class="material-symbols-outlined d-md-none icon-right">
                                    <span class="material-symbols-outlined">
                                        sentiment_satisfied
                                    </span>
                                </span>
                                <a class="nav-link text-dark" asp-area="" asp-controller="Posts" asp-action="MySubscribedPosts">
                                    <span class="material-symbols-outlined d-none d-md-block text-center">
                                        sentiment_satisfied
                                    </span>
                                    <p class="hedp">My List</p>
                                </a>
                            </li>
                            <li class="nav-item nav-li">
                                <span class="material-symbols-outlined d-md-none icon-right">
                                    article
                                </span>
                                <a class="nav-link text-dark" asp-area="" asp-controller="Posts" asp-action="MyPosts">
                                    <span class="material-symbols-outlined d-none d-md-block text-center">
                                        article
                                    </span>
                                    <p class="hedp">My Post</p>
                                </a>
                            </li>
                            <li class="nav-item nav-li-bt">
                                <a class="nav-link text-white btn btn-primary" asp-area="" asp-controller="Posts" asp-action="Create" style="margin-left:10px; margin-right:10px;">Create Post</a>
                            </li>
                            <li class="nav-item nav-li">
                                <span class="material-symbols-outlined d-md-none icon-right">
                                    reviews
                                </span>
                                <a class="nav-link text-dark" asp-area="" asp-controller="Reviews" asp-action="ReviewablePosts">
                                    <span class="material-symbols-outlined d-none d-md-block text-center">
                                        reviews
                                    </span>
                                    <p class="hedp">レビュー</p>
                                </a>
                            </li>
                        }
                        @if (isAdmin)
                        {
                            <li class="nav-item">
                                <a class="nav-link text-dark" asp-area="" asp-controller="Roles" asp-action="Index">Roles</a>
                            </li>
                        }
                        <li class="nav-item nav-li">
                            <span class="material-symbols-outlined d-md-none icon-right">
                                menu_book
                            </span>
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Guide">
                                <span class="material-symbols-outlined d-none d-md-block text-center">
                                    menu_book
                                </span>
                                <p class="hedp">Guide</p>
                            </a>
                        </li>
                    </ul>
                    <partial name="_LoginPartial" />
                </div>
            </div>
        </nav>
    </header>

    <div id="main" class="container main-top">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    @if (isSignedIn)
    {
        <div class="d-md-none navbar navbar-expand-lg navbar-light bg-light fixed-bottom border-top p-0">
            <ul class="navbar-nav nav-justified w-100 d-flex flex-row mb-1">
                <!-- フレックスユーティリティクラスを追加 -->
                <li class="nav-item flex-fill text-center">
                    <!-- flex-fill と text-center を追加 -->
                    <a class="nav-link p-0 @await Component.InvokeAsync("ActiveLink", new { controller = "Posts", action = "Index" })" asp-controller="Posts" asp-action="Index">
                        <span class="material-symbols-outlined lh-1 mt-2">
                            home
                        </span>
                        <p class="lh-1 mb-1 fw-bold" style="font-size:10px;">Home</p>
                    </a>
                </li>
                <li class="nav-item flex-fill text-center">
                    <!-- flex-fill と text-center を追加 -->
                    <a class="nav-link p-0 @await Component.InvokeAsync("ActiveLink", new { controller = "Posts", action = "MySubscribedPosts" })" asp-controller="Posts" asp-action="MySubscribedPosts">
                        <span class="material-symbols-outlined lh-1 mt-2">
                            sentiment_satisfied
                        </span>
                        <p class="lh-1 mb-1 fw-bold" style="font-size:10px;">My List</p>
                    </a>
                </li>
                <li class="nav-item flex-fill text-center">
                    <!-- flex-fill と text-center を追加 -->
                    <a class="nav-link p-0 @await Component.InvokeAsync("ActiveLink", new { controller = "Posts", action = "MyPosts" })" asp-controller="Posts" asp-action="MyPosts">
                        <span class="material-symbols-outlined lh-1 mt-2">
                            article
                        </span>
                        <p class="lh-1 mb-1 mt-0 fw-bold" style="font-size:10px;">My Post</p>
                    </a>
                </li>
            </ul>
        </div>
    }
    

    <footer class="border-top footer text-muted">
        <div class="container">
            <div class="row">
                <!-- About section -->
                <div class="col-md-4 col-sm-12">
                    <br />
                    from
                    <a class="navbar-brand ff-title" style="color: #5985E1; margin-left:20px;" href="https://roadmint.co.jp">
                        <img src="~/img/roadmint_yoko.png" width="150" height="100">
                    </a>
                </div>

                <!-- Legal section -->
                <div class="col-md-4 col-sm-12">
                    <p style="padding:0;margin:0;"><a asp-controller="Home" asp-action="Tos">利用規約</a></p>
                    <p style="padding:0;margin:0;"><a asp-controller="Home" asp-action="Tokutei">特定商取引に基づく表記</a></p>
                    <p style="padding:0;margin:0;"><a asp-controller="Home" asp-action="Privacy">プライバシーポリシー</a></p>
                </div>

                <div class="col-md-4 col-sm-12">
                    <p style="padding:0;margin:0;"><a asp-controller="Home" asp-action="Guide">使い方</a></p>
                    <p style="padding:0;margin:0;"><a asp-controller="Contacts" asp-action="Create">お問い合わせ</a></p>
                </div>
            </div>
        </div>
        <div style="text-align:center;">
            &copy; 2023 - Mint SPORTS from RoadMint Inc.
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/site.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

@section Scripts{
    <script>
        var beforePos = 0;//スクロールの値の比較用の設定

        //スクロール途中でヘッダーが消え、上にスクロールすると復活する設定を関数にまとめる
        function ScrollAnime() {
            var elemTop = $('#main').offset().top;//#area-2の位置まできたら
            var scroll = $(window).scrollTop();
            //ヘッダーの出し入れをする
            if (scroll == beforePos) {
                //IE11対策で処理を入れない
            } else if (elemTop > scroll || 0 > scroll - beforePos) {
                //ヘッダーが上から出現する
                $('#header').removeClass('UpMove'); //#headerにUpMoveというクラス名を除き
                $('#header').addClass('DownMove');//#headerにDownMoveのクラス名を追加
            } else {
                //ヘッダーが上に消える
                $('#header').removeClass('DownMove');//#headerにDownMoveというクラス名を除き
                $('#header').addClass('UpMove');//#headerにUpMoveのクラス名を追加
            }

            beforePos = scroll;//現在のスクロール値を比較用のbeforePosに格納
        }


        // 画面をスクロールをしたら動かしたい場合の記述
        $(window).scroll(function () {
            ScrollAnime();//スクロール途中でヘッダーが消え、上にスクロールすると復活する関数を呼ぶ
        });
    </script>
}